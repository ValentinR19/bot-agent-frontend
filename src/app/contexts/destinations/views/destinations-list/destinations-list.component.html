<div class="destinations-list-page">
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex justify-content-between align-items-center p-3">
        <h2>Gestión de Destinos</h2>
        <p-button label="Nuevo Destino" icon="pi pi-plus" (onClick)="goToCreate()"></p-button>
      </div>
    </ng-template>

    <p-table
      [value]="destinations"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} destinos"
      [rowsPerPageOptions]="[10, 25, 50]"
      [globalFilterFields]="['name', 'type', 'description']"
      #dt
    >
      <ng-template pTemplate="caption">
        <div class="flex">
          <span class="p-input-icon-left ml-auto">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')" placeholder="Buscar..." />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">Nombre <p-sortIcon field="name"></p-sortIcon></th>
          <th pSortableColumn="type">Tipo <p-sortIcon field="type"></p-sortIcon></th>
          <th>Descripción</th>
          <th pSortableColumn="isActive">Estado <p-sortIcon field="isActive"></p-sortIcon></th>
          <th>Llamadas</th>
          <th>Errores</th>
          <th pSortableColumn="lastUsedAt">Último Uso <p-sortIcon field="lastUsedAt"></p-sortIcon></th>
          <th>Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-destination>
        <tr>
          <td>{{ destination.name }}</td>
          <td>
            <p-tag [value]="getTypeLabel(destination.type)" severity="info"></p-tag>
          </td>
          <td>
            <span class="text-gray-600">{{ destination.description || '-' }}</span>
          </td>
          <td>
            <p-tag [value]="destination.isActive ? 'Activo' : 'Inactivo'" [severity]="destination.isActive ? 'success' : 'danger'"></p-tag>
          </td>
          <td>
            <span class="badge badge-info">{{ destination.totalCalls }}</span>
          </td>
          <td>
            <span class="badge" [class.badge-danger]="destination.totalErrors > 0" [class.badge-success]="destination.totalErrors === 0">
              {{ destination.totalErrors }}
            </span>
          </td>
          <td>
            {{ destination.lastUsedAt ? (destination.lastUsedAt | date: 'dd/MM/yyyy HH:mm') : 'Nunca' }}
          </td>
          <td>
            <div class="flex gap-2">
              <p-button icon="pi pi-eye" [rounded]="true" [text]="true" severity="info" (onClick)="goToDetail(destination.id)" pTooltip="Ver detalle"></p-button>
              <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="warn" (onClick)="goToEdit(destination.id)" pTooltip="Editar"></p-button>
              <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" (onClick)="confirmDelete(destination)" pTooltip="Eliminar"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center">No se encontraron destinos.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>
