<p-table [value]="chunks" [paginator]="true" [rows]="10" responsiveLayout="scroll">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="chunkIndex" style="width: 80px"># <p-sortIcon field="chunkIndex"></p-sortIcon></th>
      <th>Preview</th>
      <th style="width: 120px">Tokens</th>
      <th style="width: 130px" *ngIf="showSimilarity">Similitud</th>
      <th style="width: 100px">Acciones</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-chunk>
    <tr>
      <td>
        <p-badge [value]="chunk.chunkIndex" severity="info"></p-badge>
      </td>
      <td>
        <div class="chunk-preview">
          {{ getPreview(chunk.chunkText) }}
        </div>
      </td>
      <td class="text-center">
        <p-badge [value]="chunk.tokenCount" severity="secondary"></p-badge>
      </td>
      <td class="text-center" *ngIf="showSimilarity">
        <p-badge [value]="formatSimilarity(chunk.similarityScore)" severity="success"></p-badge>
      </td>
      <td>
        <p-button icon="pi pi-eye" [rounded]="true" [text]="true" severity="info" (onClick)="viewFullChunk(chunk)"></p-button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td [attr.colspan]="showSimilarity ? 5 : 4" class="text-center p-5">
        <i class="pi pi-inbox text-6xl text-gray-300 mb-3"></i>
        <p class="text-gray-500">No hay chunks disponibles</p>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Dialog para ver chunk completo -->
<p-dialog [(visible)]="showDialog" [modal]="true" [style]="{ width: '800px' }" header="Chunk completo" [closable]="true">
  <div class="chunk-detail" *ngIf="selectedChunk">
    <div class="chunk-metadata mb-3">
      <div class="flex gap-3">
        <div>
          <strong>√çndice:</strong>
          <p-badge [value]="selectedChunk.chunkIndex" severity="info" class="ml-2"></p-badge>
        </div>
        <div>
          <strong>Tokens:</strong>
          <p-badge [value]="selectedChunk.tokenCount" severity="secondary" class="ml-2"></p-badge>
        </div>
        <div *ngIf="selectedChunk.similarityScore">
          <strong>Similitud:</strong>
          <p-badge [value]="formatSimilarity(selectedChunk.similarityScore)" severity="success" class="ml-2"></p-badge>
        </div>
      </div>
    </div>

    <p-scrollPanel [style]="{ width: '100%', height: '400px' }">
      <div class="chunk-text">
        {{ selectedChunk.chunkText }}
      </div>
    </p-scrollPanel>

    <!-- Metadatos adicionales (JSON) -->
    <div class="mt-3" *ngIf="selectedChunk.metadata && Object.keys(selectedChunk.metadata).length > 0">
      <strong>Metadatos:</strong>
      <pre class="metadata-json">{{ selectedChunk.metadata | json }}</pre>
    </div>
  </div>
</p-dialog>
