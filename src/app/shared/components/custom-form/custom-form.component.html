<form [formGroup]="formGroup" (ngSubmit)="onSubmit()" class="custom-form">
  <div class="form-fields">
    <div *ngFor="let field of fields" class="form-field">
      <label [for]="field.name" class="form-label">
        {{ field.label }}
        <span *ngIf="field.required" class="required">*</span>
      </label>

      <!-- Text, Email, Password -->
      <input
        *ngIf="['text', 'email', 'password'].includes(field.type)"
        [id]="field.name"
        [type]="field.type"
        [formControlName]="field.name"
        [placeholder]="field.placeholder || ''"
        [disabled]="field.disabled"
        pInputText
        class="w-full"
        [class.ng-invalid]="isFieldInvalid(field.name)"
        [class.ng-dirty]="isFieldInvalid(field.name)" />

      <!-- Number -->
      <p-inputNumber
        *ngIf="field.type === 'number'"
        [formControlName]="field.name"
        [placeholder]="field.placeholder || ''"
        [disabled]="field.disabled"
        [min]="field.min"
        [max]="field.max"
        styleClass="w-full"
        [class.ng-invalid]="isFieldInvalid(field.name)"
        [class.ng-dirty]="isFieldInvalid(field.name)">
      </p-inputNumber>

      <!-- Textarea -->
      <textarea
        *ngIf="field.type === 'textarea'"
        [id]="field.name"
        [formControlName]="field.name"
        [placeholder]="field.placeholder || ''"
        [disabled]="field.disabled"
        [rows]="field.rows || 3"
        pInputTextarea
        class="w-full"
        [class.ng-invalid]="isFieldInvalid(field.name)"
        [class.ng-dirty]="isFieldInvalid(field.name)">
      </textarea>

      <!-- Dropdown -->
      <p-dropdown
        *ngIf="field.type === 'dropdown'"
        [formControlName]="field.name"
        [options]="field.options || []"
        [placeholder]="field.placeholder || 'Seleccionar'"
        [disabled]="field.disabled"
        styleClass="w-full"
        [class.ng-invalid]="isFieldInvalid(field.name)"
        [class.ng-dirty]="isFieldInvalid(field.name)">
      </p-dropdown>

      <!-- Date -->
      <p-calendar
        *ngIf="field.type === 'date'"
        [formControlName]="field.name"
        [placeholder]="field.placeholder || 'Seleccionar fecha'"
        [disabled]="field.disabled"
        dateFormat="dd/mm/yy"
        styleClass="w-full"
        [class.ng-invalid]="isFieldInvalid(field.name)"
        [class.ng-dirty]="isFieldInvalid(field.name)">
      </p-calendar>

      <!-- Checkbox -->
      <p-checkbox
        *ngIf="field.type === 'checkbox'"
        [formControlName]="field.name"
        [binary]="true"
        [disabled]="field.disabled">
      </p-checkbox>

      <!-- Error message -->
      <small *ngIf="isFieldInvalid(field.name)" class="p-error">
        {{ getErrorMessage(field.name) }}
      </small>
    </div>
  </div>

  <div class="form-actions">
    <button
      *ngIf="showCancel"
      pButton
      type="button"
      [label]="cancelLabel"
      icon="pi pi-times"
      class="p-button-text"
      (click)="onCancel()"
      [disabled]="loading">
    </button>
    <button
      pButton
      type="submit"
      [label]="submitLabel"
      icon="pi pi-check"
      [disabled]="formGroup.invalid"
      [loading]="loading">
    </button>
  </div>
</form>
